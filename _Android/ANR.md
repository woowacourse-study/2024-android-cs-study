
## ANR

- Application Not Responding의 약자로 애플리케이션이 응답하지 않음을 뜻한다.
- 안드로이드 디벨로퍼에서는 아래와 같이 정의한다.
```
Android 앱의 UI 쓰레드가 너무 오랫동안 차단될 시 ANR 오류가 발생한다.
아래 그림과 같이 사용자에게 대화상자를 표시하며, 사용자가 앱을 강제종료할 수 있다.
```
![anr](https://github.com/woowacourse-study/2024-android-cs-study/assets/85734140/706168e4-1819-4387-82d4-5c8cc69ddb41)

- ANR은 UI 업데이트를 담당하는 앱의 기본 쓰레드가 사용자 입력 이벤트 또는 그림을
  처리하지 못해 사용자 불만을 초래하므로 큰 문제가 된다.
- ANR은 메인 쓰레드가 일정 시간 동안 작업을 처리하지 못하면 발생하는 에러이다.

### ANR 발생 조건

- **입력 전달 타임아웃**
  - 앱이 입력 이벤트 (키 누름 또는 화면 터치)에 5초 이내에 응답하지 않는 경우
- **서비스 실행**
  - 앱에서 선언한 서비스가 몇 초 이내에 아래의 동작을 실행할 수 없는 경우
  - `Service.onCreate()`
  - `Service.onStartCommand()`
  - `Service.onBind()`
- **인텐트 브로드캐스트**
  - BroadcastReceiver가 설정 된 시간 내에 실행을 완료하지 못한 경우
  - 앱에 포그라운드 활동이 있는 경우 5초의 제한 시간이 있음
- **JobScheduler 상호작용**
  - JobService가 몇 초 이내에 반환되지 않음

### ANR 진단하기

- 앱이 메인 쓰레드에서 I/O(입출력)과 관려된 느린 작업을 진행
- 앱이 메인 쓰레드에서 긴 계산을 실행
- 다른 쓰레드에서 발생하는 긴 작업을 위해 동기화된 블록을 대기하는 동안 기본 쓰레드 차단
- 메인 쓰레드가 프로세스에서 또는 바인더 호출을 통해 다른 쓰레드와 교착 상태에 있음

### ANR 해결하기

- 시간이 많이 걸리는 작업을 서브 쓰레드에서 동작하게 해서 메인 쓰레드의 부하를 줄임
- AsyncTask 등 비동기 처리를 통해 작업과 작업 내용을 실시간으로 UI에 업데이트
- 비동기 통신 라이브러리를 활용

### 결론

- 메인 쓰레드에서 수행하는 작업이 너무 많다면 메인 쓰레드가 과부화 상태에 걸림
- 비동기 쓰레드를 만들어서 작업을 나눠 처리

### 용어 정리 

- **교착 상태**
  - 한 스레드에서 필요한 리소스를 다른 스레드가 보유
  - 다른 스레드 역시 첫 번째 스레드가 보유 중인 리소스 대기
  - 스레드가 연속 대기 상태가 되는 경우가 발생하며 이를 교착 상태라고 한다.
- **Background Service**
  - 사용자에게 보이지 않고 묵시적으로 실행
  - 사용자가 작동 여부를 알지 못함
  - 데이터 동기화, 네트워크 요청, DB 업데이트 등
- **Foreground Service**
  - 사용자에게 눈에 띄는 작업을 수행
  - 사용자가 앱과 상호작용 하지 않는 경우에도 실행 됨 (ex> 알림)

  
